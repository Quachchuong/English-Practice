<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Daily Conversation - Level 3</title>
    <style>
        :root {
            --char-a-color: #e17055;  /* Cam ?m Ã¡p */
            --char-b-color: #8e44ad;  /* TÃ­m */
            --text-dark: #2d3436;
            --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
        }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: var(--bg-gradient);
            margin: 0; padding: 20px;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; -webkit-tap-highlight-color: transparent;
        }
        .container {
            width: 100%; max-width: 520px;
            background: white; border-radius: 30px;
            padding: 35px; box-shadow: 0 20px 50px rgba(0,0,0,0.12);
            text-align: center;
        }
        #role-selection { display: block; }
        .role-card {
            padding: 28px; margin: 18px 0;
            border-radius: 20px; border: 2px solid #dfe6e9;
            cursor: pointer; transition: all 0.3s ease;
        }
        .role-card:active { transform: scale(0.97); }
        .role-card.a { border-color: var(--char-a-color); color: var(--char-a-color); }
        .role-card.b { border-color: var(--char-b-color); color: var(--char-b-color); }
        #lesson-stage { display: none; }
        #main-stage {
            background: #f8f0ff; border: 3px dashed #b980f0;
            border-radius: 25px; padding: 45px 20px;
            min-height: 300px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; margin: 25px 0;
        }
        #role-indicator { font-size: 0.95rem; font-weight: 800; text-transform: uppercase; margin-bottom: 18px; }
        #sentence-text { font-size: 1.35rem; font-weight: bold; line-height: 1.6; color: var(--text-dark); }
        #speakBtn {
            width: 110px; height: 110px; border-radius: 50%; border: none;
            background: var(--char-b-color); color: white;
            font-size: 1.1rem; font-weight: bold; cursor: pointer;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 12px 25px rgba(0,0,0,0.15);
            transition: all 0.2s;
        }
        #speakBtn.active { background: #e74c3c; transform: scale(0.94); }
        #speakBtn .icon { font-size: 34px; margin-bottom: 6px; }
        .btn-system {
            padding: 14px 28px; border-radius: 50px; border: none;
            font-weight: bold; cursor: pointer; background: #636e72; color: white;
            margin: 8px;
        }
        #next-lesson-btn {
            background: #27ae60; margin-top: 15px;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="role-selection">
        <h2 style="margin-top:0">Daily Conversation<br>Level 3</h2>
        <p>Choose your character:</p>
        <div class="role-card a" onclick="startLesson('A')">
            <h3>I want to be A</h3>
            <p>(Start first)</p>
        </div>
        <div class="role-card b" onclick="startLesson('B')">
            <h3>I want to be B</h3>
            <p>(Listen first)</p>
        </div>
    </div>
    <div id="lesson-stage">
        <div id="role-indicator">---</div>
        <div id="main-stage">
            <div id="sentence-text">Preparing...</div>
            <div style="height: 130px; display: flex; align-items: center; margin-top: 25px;">
                <button id="speakBtn">
                    <span class="icon">ðŸŽ¤</span>
                    <span id="btn-label">HOLD</span>
                </button>
            </div>
            <div id="mic-hint" style="font-size: 0.85rem; color: #636e72; margin-top: 12px;"></div>
        </div>
        <button class="btn-system" onclick="location.reload()"> ðŸŽ¤ Switch Role</button>
        <button class="btn-system" onclick="smartBack()" style="background:none; color:#636e72; text-decoration:underline">Exit</button>
        <button id="next-lesson-btn" class="btn-system" style="display:none;" onclick="alert('Coming soon! Stay tuned for Level 4 ??')">?? Next Lesson</button>
    </div>
</div>
<script>
   const script = [
  { a: "Hey, it's been a while! How have you been lately?", b: "I've been pretty good, thanks. Life's been busy but interesting." },
  { a: "Busy in a good way, I hope?", b: "Yeah, mostly good things. Work has picked up a lot." },
  { a: "Are you still working at the same company?", b: "Yes, but my role has changed a bit recently." },
  { a: "Oh really? What kind of changes?", b: "Iâ€™m handling more responsibilities and small projects now." },
  { a: "That sounds like progress.", b: "It is, though it can be stressful sometimes." },
  { a: "...", b: "" },

  { a: "How do you usually deal with stress?", b: "I try to exercise and avoid checking my phone too much." },
  { a: "Thatâ€™s a good habit. What kind of exercise do you do?", b: "Mostly jogging and some light workouts at home." },
  { a: "Do you exercise every day?", b: "Not every day, but at least three times a week." },
  { a: "Consistency is what matters.", b: "Exactly. Iâ€™ve learned that the hard way." },
  { a: "...", b: "" },

  { a: "Have you picked up any new hobbies recently?", b: "Actually yes, I started learning the guitar." },
  { a: "Nice! What made you choose the guitar?", b: "Iâ€™ve always loved acoustic music, so it felt natural." },
  { a: "Is it difficult to learn?", b: "At first, my fingers hurt a lot, but itâ€™s getting better." },
  { a: "How often do you practice?", b: "I try to practice for about an hour every evening." },
  { a: "...", b: "" },

  { a: "What kind of songs do you want to play?", b: "Mostly pop songs and some simple ballads." },
  { a: "Have you played in front of anyone yet?", b: "Not yet. Iâ€™m still a bit shy about it." },
  { a: "Thatâ€™s understandable. Confidence comes with time.", b: "I hope so. Maybe Iâ€™ll play for friends soon." },
  { a: "...", b: "" },

  { a: "What do you usually do on weekends?", b: "I relax, practice guitar, or meet friends for coffee." },
  { a: "Do you have a favorite cafÃ©?", b: "Yes, thereâ€™s a small one near the park." },
  { a: "What do you like about it?", b: "Itâ€™s quiet, cozy, and the coffee is great." },
  { a: "...", b: "" },

  { a: "Do you prefer working from home or the office?", b: "I prefer a mix of both, actually." },
  { a: "Why is that?", b: "Working from home saves time, but the office feels more social." },
  { a: "That makes sense.", b: "Yeah, balance is important." },
  { a: "...", b: "" },

  { a: "How do you manage your time when working remotely?", b: "I set a clear schedule and take short breaks." },
  { a: "Do you ever get distracted?", b: "Of course, especially by social media." },
  { a: "Same here. Itâ€™s hard to resist.", b: "I usually put my phone away when I need to focus." },
  { a: "...", b: "" },

  { a: "Have you read any good books lately?", b: "I just finished a mystery novel." },
  { a: "Was it good?", b: "Very engaging. I couldnâ€™t put it down." },
  { a: "I should add it to my reading list.", b: "I can send you the title later." },
  { a: "...", b: "" },

  { a: "Are you planning any trips this year?", b: "Yes, Iâ€™m hoping to visit Japan in the fall." },
  { a: "That sounds exciting!", b: "Iâ€™m really looking forward to it." },
  { a: "What excites you the most?", b: "The food, culture, and autumn scenery." },
  { a: "Have you started learning Japanese?", b: "Just basic phrases for now." },
  { a: "...", b: "" },

  { a: "Thatâ€™s still a good start.", b: "I think so too." },
  { a: "It was really nice catching up with you.", b: "Same here. We should talk more often." },
  { a: "Definitely. Letâ€™s not wait so long next time.", b: "Agreed. Take care!" },
  { a: "You too. Good luck with the guitar!", b: "Thanks! See you soon." }
];


    const fullConversation = [];
    script.forEach(pair => {
        if (pair.a && pair.a.trim() !== "") fullConversation.push({ role: 'A', text: pair.a });
        if (pair.b && pair.b.trim() !== "") fullConversation.push({ role: 'B', text: pair.b });
    });

    let userRole = '';
    let currentIndex = 0;
    const synth = window.speechSynthesis;

    function startLesson(role) {
        userRole = role;
        document.getElementById('role-selection').style.display = 'none';
        document.getElementById('lesson-stage').style.display = 'block';
        const unlock = new SpeechSynthesisUtterance("");
        synth.speak(unlock);
        playRound();
    }

    function updateUI() {
        const current = fullConversation[currentIndex];
        const roleInd = document.getElementById('role-indicator');
        const sentTxt = document.getElementById('sentence-text');
        const speakBtn = document.getElementById('speakBtn');
        const micHint = document.getElementById('mic-hint');
        const isUserTurn = current.role === userRole;
        const themeColor = userRole === 'A' ? 'var(--char-a-color)' : 'var(--char-b-color)';

        roleInd.textContent = isUserTurn ? `YOUR TURN (${userRole})` : `LISTENING TO ${current.role}...`;
        roleInd.style.color = isUserTurn ? themeColor : '#e74c3c';

        sentTxt.textContent = current.text;
        sentTxt.style.color = isUserTurn ? themeColor : '#2d3436';

        speakBtn.style.backgroundColor = themeColor;
        speakBtn.style.display = isUserTurn ? 'flex' : 'none';
        micHint.textContent = isUserTurn ? "Hold the button and speak" : "";
    }

    async function playRound() {
        if (currentIndex >= fullConversation.length) {
            document.getElementById('sentence-text').textContent = "?? Fantastic! You've completed Level 3!";
            document.getElementById('speakBtn').style.display = 'none';
            document.getElementById('role-indicator').textContent = "COMPLETED";
            document.getElementById('next-lesson-btn').style.display = 'inline-block';
            return;
        }
        updateUI();
        const current = fullConversation[currentIndex];
        if (current.role !== userRole) {
            await new Promise(r => setTimeout(r, 800));
            speak(current.text);
        }
    }

    function speak(text) {
        synth.cancel();
        if (text === "...") {
            setTimeout(() => {
                currentIndex++;
                playRound();
            }, 1500);
            return;
        }
        const ut = new SpeechSynthesisUtterance(text);
        ut.lang = 'en-US';
        ut.rate = 0.95;
        ut.onend = () => { currentIndex++; playRound(); };
        synth.speak(ut);
    }

    function startActing() {
        document.getElementById('speakBtn').classList.add('active');
        document.getElementById('btn-label').textContent = "SPEAKING";
    }

    function stopActing() {
        document.getElementById('speakBtn').classList.remove('active');
        document.getElementById('btn-label').textContent = "HOLD";
        currentIndex++;
        playRound();
    }

    function smartBack() {
        if (window.opener || window.history.length === 1) window.close();
        else window.history.back();
    }

    const sBtn = document.getElementById('speakBtn');
    sBtn.onmousedown = startActing;
    window.onmouseup = () => { if (sBtn.classList.contains('active')) stopActing(); };
    sBtn.addEventListener('touchstart', (e) => { e.preventDefault(); startActing(); }, {passive: false});
    sBtn.addEventListener('touchend', (e) => { e.preventDefault(); stopActing(); }, {passive: false});
</script>
</body>
</html>
